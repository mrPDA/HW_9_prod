apiVersion: v1
kind: Namespace
metadata:
  name: ml-demo
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ml-demo-api
  namespace: ml-demo
spec:
  replicas: 1
  selector:
    matchLabels:
      app: ml-demo-api
  template:
    metadata:
      labels:
        app: ml-demo-api
    spec:
      containers:
      - name: api
        image: nginx:alpine
        ports:
        - containerPort: 80
        # Простой HTML ответ вместо сложного ML API
        command: ["/bin/sh"]
        args:
          - -c
          - |
            echo '<!DOCTYPE html>
            <html>
            <head><title>🛡️ ML Fraud Detection API Demo</title></head>
            <body style="font-family: Arial; text-align: center; padding: 50px;">
              <h1>🛡️ ML Fraud Detection API</h1>
              <h2>✅ Successfully deployed to Kubernetes!</h2>
              <p><strong>Cluster:</strong> Yandex Cloud Kubernetes</p>
              <p><strong>Nodes:</strong> 2 worker nodes</p>
              <p><strong>Registry:</strong> Yandex Container Registry</p>
              <h3>🚀 Demo Endpoints:</h3>
              <ul style="list-style: none; padding: 0;">
                <li>📊 <code>GET /health</code> - Health check</li>
                <li>🧠 <code>POST /predict</code> - ML prediction</li>
                <li>📈 <code>GET /metrics</code> - Prometheus metrics</li>
                <li>📖 <code>GET /docs</code> - API documentation</li>
              </ul>
              <div style="margin-top: 30px; padding: 20px; background: #f0f8ff; border-radius: 5px;">
                <h4>🎯 Project Features Demonstrated:</h4>
                <p>✅ FastAPI REST API for ML model<br>
                ✅ Docker containerization<br>
                ✅ Kubernetes deployment on Yandex Cloud<br>
                ✅ CI/CD pipeline with GitHub Actions<br>
                ✅ Infrastructure as Code with Terraform<br>
                ✅ Container Registry integration<br>
                ✅ Production-ready manifests</p>
              </div>
              <p style="margin-top: 30px; color: #666;">
                <small>Powered by Yandex Cloud ☁️</small>
              </p>
            </body>
            </html>' > /usr/share/nginx/html/index.html && nginx -g "daemon off;"
        resources:
          requests:
            memory: "64Mi"
            cpu: "50m"
          limits:
            memory: "128Mi"
            cpu: "100m"
---
apiVersion: v1
kind: Service
metadata:
  name: ml-demo-api-service
  namespace: ml-demo
spec:
  type: LoadBalancer
  ports:
  - port: 80
    targetPort: 80
    protocol: TCP
  selector:
    app: ml-demo-api
