# ๐ก๏ธ ML Fraud Detection API

Production-ready REST API ัะตัะฒะธั ะดะปั ะดะตัะตะบัะธะธ ะผะพัะตะฝะฝะธัะตัะบะธั ััะฐะฝะทะฐะบัะธะน ั ะธะฝัะตะณัะฐัะธะตะน MLflow Model Registry ะธ ัะฐะทะฒะตัััะฒะฐะฝะธะตะผ ะฒ Kubernetes.

## ๐ฏ ะะพะทะผะพะถะฝะพััะธ

- **๐ REST API** ั ัะฝะดะฟะพะธะฝัะฐะผะธ ะดะปั ะฟัะตะดัะบะฐะทะฐะฝะธะน
- **๐ค MLflow ะธะฝัะตะณัะฐัะธั** ะดะปั ะทะฐะณััะทะบะธ ะผะพะดะตะปะตะน ะธะท Registry
- **๐ Prometheus ะผะตััะธะบะธ** ะดะปั ะผะพะฝะธัะพัะธะฝะณะฐ
- **๐ฅ Health checks** ะดะปั Kubernetes ะฟัะพะฑ
- **โธ๏ธ Kubernetes ready** ั ะผะฐะฝะธัะตััะฐะผะธ ะดะปั ัะฐะทะฒะตัััะฒะฐะฝะธั
- **๐ CI/CD** ะฐะฒัะพะผะฐัะธะทะฐัะธั ัะตัะตะท GitHub Actions
- **๐ณ Docker** ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั ั multi-stage ัะฑะพัะบะพะน

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   Client App    โโโโโถโ  Load Balancer  โโโโโถโ  Fraud API Pod  โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
                                                       โ
                                                       โผ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   Prometheus    โโโโโโ   Kubernetes    โโโโโถโ MLflow Registry โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
```

## ๐ ะัััััะน ััะฐัั

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

1. **ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั:**
```bash
git clone <repository-url>
cd ml-k8s-fraud-detection
```

2. **ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน:**
```bash
pip install -r app/requirements.txt
```

3. **ะะฐัััะพะนะบะฐ ะพะบััะถะตะฝะธั:**
```bash
cp env.example .env
# ะััะตะดะฐะบัะธััะนัะต .env ั ะฒะฐัะธะผะธ ะฝะฐัััะพะนะบะฐะผะธ
```

4. **ะะฐะฟััะบ ัะตัะฒะธัะฐ:**
```bash
cd app
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

5. **ะัะพะฒะตัะบะฐ ัะฐะฑะพัั:**
```bash
curl http://localhost:8000/health/
```

### Docker ัะฐะทะฒะตัััะฒะฐะฝะธะต

1. **ะกะฑะพัะบะฐ ะพะฑัะฐะทะฐ:**
```bash
docker build -t fraud-detection-api:latest .
```

2. **ะะฐะฟััะบ ะบะพะฝัะตะนะฝะตัะฐ:**
```bash
docker run -d \
  --name fraud-api \
  -p 8000:8000 \
  -p 9090:9090 \
  -e MLFLOW_TRACKING_URI="http://your-mlflow:5000" \
  -e MODEL_NAME="fraud_detection_yandex_model" \
  fraud-detection-api:latest
```

## ๐ API ะะพะบัะผะตะฝัะฐัะธั

### ะัะฝะพะฒะฝัะต ัะฝะดะฟะพะธะฝัั

| ะญะฝะดะฟะพะธะฝั | ะะตัะพะด | ะะฟะธัะฐะฝะธะต |
|----------|-------|----------|
| `/` | GET | ะะฝัะพัะผะฐัะธั ะพ ัะตัะฒะธัะต |
| `/predict` | POST | ะัะตะดัะบะฐะทะฐะฝะธะต ะดะปั ะพะดะฝะพะน ััะฐะฝะทะฐะบัะธะธ |
| `/predict/batch` | POST | Batch ะฟัะตะดัะบะฐะทะฐะฝะธั (ะดะพ 100 ััะฐะฝะทะฐะบัะธะน) |
| `/health/` | GET | Health check |
| `/health/ready` | GET | Readiness probe |
| `/health/live` | GET | Liveness probe |
| `/metrics/` | GET | ะะฑะทะพั ะผะตััะธะบ |
| `/metrics/prometheus` | GET | Prometheus ะผะตััะธะบะธ |
| `/docs` | GET | Swagger UI ะดะพะบัะผะตะฝัะฐัะธั |

### ะัะธะผะตั ะทะฐะฟัะพัะฐ

```bash
curl -X POST "http://localhost:8000/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "transaction_id": "txn_123456",
    "amount": 150.75,
    "merchant_category": "restaurant", 
    "hour_of_day": 14,
    "day_of_week": 2,
    "user_age": 35,
    "location_risk_score": 0.2
  }'
```

### ะัะธะผะตั ะพัะฒะตัะฐ

```json
{
  "transaction_id": "txn_123456",
  "is_fraud": false,
  "fraud_probability": 0.23,
  "confidence": "medium",
  "model_version": "1",
  "prediction_timestamp": "2025-09-17T08:00:00Z",
  "processing_time_ms": 12.5
}
```

## โธ๏ธ Kubernetes ัะฐะทะฒะตัััะฒะฐะฝะธะต

### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

- Kubernetes ะบะปะฐััะตั (ะฒะตััะธั 1.20+)
- kubectl ะฝะฐัััะพะตะฝ ะดะปั ะฟะพะดะบะปััะตะฝะธั ะบ ะบะปะฐััะตัั
- Container Registry ะดะปั Docker ะพะฑัะฐะทะพะฒ

### ะะฐะทะฒะตัััะฒะฐะฝะธะต

1. **ะกะพะทะดะฐะฝะธะต namespace:**
```bash
kubectl create namespace fraud-detection
```

2. **ะัะธะผะตะฝะตะฝะธะต ะผะฐะฝะธัะตััะพะฒ:**
```bash
kubectl apply -f k8s/ -n fraud-detection
```

3. **ะัะพะฒะตัะบะฐ ััะฐัััะฐ:**
```bash
kubectl get pods -n fraud-detection
kubectl get services -n fraud-detection
```

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### ะะฐะฟััะบ ัะตััะพะฒ

```bash
# ะฎะฝะธั-ัะตััั
pytest tests/ -v

# ะขะตััั ั ะฟะพะบัััะธะตะผ
pytest tests/ --cov=app --cov-report=html

# ะขะตััั API
pytest tests/test_api.py -v

# ะขะตััั ะผะพะดะตะปะธ
pytest tests/test_model.py -v
```

### ะะฐะณััะทะพัะฝะพะต ัะตััะธัะพะฒะฐะฝะธะต

```bash
# ะฃััะฐะฝะพะฒะบะฐ locust
pip install locust

# ะะฐะฟััะบ ะฝะฐะณััะทะพัะฝะพะณะพ ัะตััะธัะพะฒะฐะฝะธั
locust -f tests/load_test.py --host=http://localhost:8000
```

## ๐ ะะพะฝะธัะพัะธะฝะณ

### Prometheus ะผะตััะธะบะธ

ะกะตัะฒะธั ัะบัะฟะพััะธััะตั ัะปะตะดัััะธะต ะผะตััะธะบะธ:

- `ml_predictions_total` - ะะฑัะตะต ะบะพะปะธัะตััะฒะพ ะฟัะตะดัะบะฐะทะฐะฝะธะน
- `ml_prediction_duration_seconds` - ะัะตะผั ะฒัะฟะพะปะฝะตะฝะธั ะฟัะตะดัะบะฐะทะฐะฝะธะน
- `ml_prediction_errors_total` - ะะพะปะธัะตััะฒะพ ะพัะธะฑะพะบ ะฟัะตะดัะบะฐะทะฐะฝะธะน

### Grafana Dashboard

ะัะธะผะตั ะทะฐะฟัะพัะพะฒ ะดะปั Grafana:

```promql
# ะะพะปะธัะตััะฒะพ ะฟัะตะดัะบะฐะทะฐะฝะธะน ะฒ ัะตะบัะฝะดั
rate(ml_predictions_total[5m])

# ะกัะตะดะฝะตะต ะฒัะตะผั ะฟัะตะดัะบะฐะทะฐะฝะธั
rate(ml_prediction_duration_seconds_sum[5m]) / rate(ml_prediction_duration_seconds_count[5m])

# ะงะฐััะพัะฐ ะพัะธะฑะพะบ
rate(ml_prediction_errors_total[5m]) / rate(ml_predictions_total[5m])
```

## โ๏ธ ะะพะฝัะธะณััะฐัะธั

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

| ะะตัะตะผะตะฝะฝะฐั | ะะฟะธัะฐะฝะธะต | ะะพ ัะผะพะปัะฐะฝะธั |
|------------|----------|--------------|
| `MLFLOW_TRACKING_URI` | URI MLflow ัะตัะฒะตัะฐ | `http://localhost:5000` |
| `MODEL_NAME` | ะะฐะทะฒะฐะฝะธะต ะผะพะดะตะปะธ ะฒ Registry | `fraud_detection_yandex_model` |
| `MODEL_ALIAS` | ะะปะธะฐั ะผะพะดะตะปะธ | `champion` |
| `LOG_LEVEL` | ะฃัะพะฒะตะฝั ะปะพะณะธัะพะฒะฐะฝะธั | `INFO` |
| `ENABLE_METRICS` | ะะบะปััะธัั Prometheus ะผะตััะธะบะธ | `true` |
| `MAX_BATCH_SIZE` | ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั batch | `100` |

### MLflow ะผะพะดะตะปั

ะกะตัะฒะธั ะพะถะธะดะฐะตั ะผะพะดะตะปั ะฒ MLflow Registry ั:
- **ะัะพะดะฝัะต ัะธัะธ:** `amount`, `merchant_category`, `hour_of_day`, `day_of_week`, `user_age`, `location_risk_score`
- **ะััะพะดะฝัะต ะดะฐะฝะฝัะต:** ะะตัะพััะฝะพััั ะผะพัะตะฝะฝะธัะตััะฒะฐ (0-1) ะธะปะธ ะฑะธะฝะฐัะฝะฐั ะบะปะฐััะธัะธะบะฐัะธั
- **ะะตัะพะดั:** `predict()` ะธ ะพะฟัะธะพะฝะฐะปัะฝะพ `predict_proba()`

## ๐ง ะะฐะทัะฐะฑะพัะบะฐ

### ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
ml-k8s-fraud-detection/
โโโ app/                    # ะัะฝะพะฒะฝะพะต ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ main.py            # FastAPI ะฟัะธะปะพะถะตะฝะธะต
โ   โโโ core/              # ะะพะฝัะธะณััะฐัะธั ะธ ััะธะปะธัั
โ   โโโ api/               # API ัะพััะตัั
โ   โโโ models/            # ML ะผะพะดะตะปะธ
โ   โโโ requirements.txt   # Python ะทะฐะฒะธัะธะผะพััะธ
โโโ tests/                 # ะขะตััั
โโโ k8s/                   # Kubernetes ะผะฐะฝะธัะตััั
โโโ .github/workflows/     # CI/CD ะฟะฐะนะฟะปะฐะนะฝั
โโโ Dockerfile             # Docker ะพะฑัะฐะท
โโโ README.md             # ะญัะฐ ะดะพะบัะผะตะฝัะฐัะธั
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั ัะธัะตะน

1. ะกะพะทะดะฐะนัะต feature ะฒะตัะบั
2. ะะพะฑะฐะฒััะต ะบะพะด ะธ ัะตััั
3. ะฃะฑะตะดะธัะตัั ััะพ ัะตััั ะฟัะพัะพะดัั
4. ะกะพะทะดะฐะนัะต Pull Request

### Code Style

ะัะพะตะบั ะธัะฟะพะปัะทัะตั:
- **Black** ะดะปั ัะพัะผะฐัะธัะพะฒะฐะฝะธั
- **isort** ะดะปั ัะพััะธัะพะฒะบะธ ะธะผะฟะพััะพะฒ  
- **flake8** ะดะปั ะปะธะฝัะธะฝะณะฐ
- **mypy** ะดะปั ะฟัะพะฒะตัะบะธ ัะธะฟะพะฒ

## ๐จ Troubleshooting

### ะงะฐัััะต ะฟัะพะฑะปะตะผั

**ะะพะดะตะปั ะฝะต ะทะฐะณััะถะฐะตััั:**
- ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั MLflow ัะตัะฒะตัะฐ
- ะฃะฑะตะดะธัะตัั ััะพ ะผะพะดะตะปั ัััะตััะฒัะตั ะฒ Registry
- ะัะพะฒะตัััะต ะฟัะฐะฒะธะปัะฝะพััั ะฐะปะธะฐัะฐ/ััะฐะดะธะธ ะผะพะดะตะปะธ

**ะััะพะบะพะต ะฟะพััะตะฑะปะตะฝะธะต ะฟะฐะผััะธ:**
- ะฃะผะตะฝััะธัะต ัะฐะทะผะตั batch ะทะฐะฟัะพัะพะฒ
- ะัะพะฒะตัััะต ัะฐะทะผะตั ะผะพะดะตะปะธ
- ะะฐััะผะพััะธัะต ะธัะฟะพะปัะทะพะฒะฐะฝะธะต CPU/memory limits ะฒ K8s

**ะะตะดะปะตะฝะฝัะต ะฟัะตะดัะบะฐะทะฐะฝะธั:**
- ะัะพะฒะตัััะต ะฟัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะผะพะดะตะปะธ
- ะะฐััะผะพััะธัะต ะบะตัะธัะพะฒะฐะฝะธะต ะฟัะตะดัะบะฐะทะฐะฝะธะน
- ะฃะฒะตะปะธัััะต ะบะพะปะธัะตััะฒะพ ัะตะฟะปะธะบ ะฒ K8s

### ะะพะณะธ ะธ ะพัะปะฐะดะบะฐ

```bash
# ะัะพัะผะพัั ะปะพะณะพะฒ ะฒ K8s
kubectl logs -f deployment/fraud-detection-api -n fraud-detection

# ะัะปะฐะดะพัะฝะฐั ะธะฝัะพัะผะฐัะธั
curl http://localhost:8000/metrics/debug

# ะัะพะฒะตัะบะฐ health checks
curl http://localhost:8000/health/ready
```

## ๐ TODO

- [ ] ะะพะฑะฐะฒะธัั ะฐััะตะฝัะธัะธะบะฐัะธั API
- [ ] ะะตะฐะปะธะทะพะฒะฐัั ะบะตัะธัะพะฒะฐะฝะธะต ะฟัะตะดัะบะฐะทะฐะฝะธะน
- [ ] ะะพะฑะฐะฒะธัั A/B ัะตััะธัะพะฒะฐะฝะธะต ะผะพะดะตะปะตะน
- [ ] ะะฝัะตะณัะฐัะธั ั Kafka ะดะปั streaming
- [ ] ะะพะฑะฐะฒะธัั distributed tracing

## ๐ค Contributing

1. Fork ัะตะฟะพะทะธัะพัะธะน
2. ะกะพะทะดะฐะนัะต feature ะฒะตัะบั (`git checkout -b feature/amazing-feature`)
3. Commit ะธะทะผะตะฝะตะฝะธั (`git commit -m 'Add amazing feature'`)
4. Push ะฒ ะฒะตัะบั (`git push origin feature/amazing-feature`)
5. ะกะพะทะดะฐะนัะต Pull Request

## ๐ ะะธัะตะฝะทะธั

ะญัะพั ะฟัะพะตะบั ะปะธัะตะฝะทะธัะพะฒะฐะฝ ะฟะพะด MIT License - ัะผ. ัะฐะนะป [LICENSE](LICENSE) ะดะปั ะดะตัะฐะปะตะน.

## ๐ฅ ะะฒัะพัั

- **ML Team** - ะะฐะทัะฐะฑะพัะบะฐ ะธ ะฟะพะดะดะตัะถะบะฐ

---

โญ **ะัะปะธ ะฟัะพะตะบั ะพะบะฐะทะฐะปัั ะฟะพะปะตะทะฝัะผ, ะฟะพััะฐะฒััะต ะทะฒะตะทะดั!**
